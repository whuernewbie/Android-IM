### 1.引言

#### 1.1编写目的

​	软件设计结构的具体任务是将一个复杂系统按功能划分，建立模块的层次结构及调用关系，确定模块间的接口及人机界面等。
​	此系统设计说明书是为了说明TalkTalk整个系统的体系结构，以及需求用例的各个功能点在结构中的体现，为系统的详细设计人员进行详细设计时的输入参考文档。

#### 1.2背景

待开发软件的名称：TalkTalk
此项目的开发者：龙峥嵘、张艳涛、莫光严、贺振、朱俊杰、秦哲欣
用户：年轻人
将运行该软件的计算站（中心）：用户Android手机

#### 1.3 定义

SQL 语言：结构化查询语言(Structured Query Language)简称 SQL，是一种特殊
目的的编程语言，是一种数据库查询和程序设计语言，用于存取数据以及查询、
更新和管理关系数据库系统。
Andeoid：Android 是一种基于 Linux 的自由及开放源代码的操作系统，主要使
用于移动设备，如智能手机和平板电脑，由 Google 公司和开放手机联盟领导及
开发。

#### 1.4参考资料

[1]《概要设计说明书》（Gb8567-88）

[2]《需求规格说明书》

### 2.总体设计

#### 2.1 需求规定

|     功能     |      输入      |                         处理                         |     输出     |
| :----------: | :------------: | :--------------------------------------------------: | :----------: |
|     注册     |    邮箱密码    | 发送验证码，验证验证码和邮箱，确认无误侯添加到数据库 | 用户基本信息 |
|     登陆     |    账号密码    |                      查询数据库                      | 用户基本信息 |
| 查看用户信息 | 查看对象用户id |                      查询数据库                      |   用户信息   |
|     动态     |    动态内容    |               添加到数据库，查询数据库               |   动态内容   |
|     聊天     |    聊天内容    |               添加到数据库、查询数据库               |   聊天内容   |
|   修改信息   |  用户基本信息  |                   添加、修改数据库                   | 用户基本信息 |

#### 2.2运行环境

​	软件系统运行环境：Android 8.0及以上

#### 2.3基本设计概念和处理流程



##### 2.3.1 注册登陆模块设计

![注册登陆模块设计](https://images.cnblogs.com/cnblogs_com/moonstars2333/1607536/o_191206112444client-server-http.jpg)

##### 2.3.2 http服务模块

![http服务模块](https://images.cnblogs.com/cnblogs_com/moonstars2333/1607536/o_191205144134http%20%E6%9C%8D%E5%8A%A1.jpg)

##### 2.3.3websocket模块

![websocket模块](https://images.cnblogs.com/cnblogs_com/moonstars2333/1607536/o_191205144553websocket%20%E6%9C%8D%E5%8A%A1.jpg)

##### 2.3.4http服务工作流程

![http服务工作流程](https://images.cnblogs.com/cnblogs_com/moonstars2333/1607536/o_191205144402http%20%E8%BF%90%E4%BD%9C%E5%9B%BE.jpg)

##### 2.3.5websocket服务工作流程

![websocket服务工作流程](https://images.cnblogs.com/cnblogs_com/moonstars2333/1607536/o_191205144952websocket%20%E8%BF%90%E4%BD%9C%E5%9B%BE.jpg)

##### 2.3.6客户端服务器端通信交互

![客户端服务器端交互](https://images.cnblogs.com/cnblogs_com/moonstars2333/1607536/o_191206153127client-server-ws.jpg)

#### 2.4人工处理过程

​	管理账户需要人工修改数据库

#### 2.5 尚未解决的问题

​	动态部分尚未处理。

### 3. 接口设计

#### 3.1 用户接口

|   命令   |      语法       |                  信息回复                  |
| :------: | :-------------: | :----------------------------------------: |
|   注册   | Click事件，点击 |           进入注册页面/注册反馈            |
|   登陆   | Click事件，点击 |           进入首页/提示错误信息            |
| 忘记密码 | Click事件，点击 |            进入重新设置密码界面            |
|   首页   | Click事件，点击 | 点击打开右侧折叠菜单/点击消息进入聊天界面/ |
| 搜索好友 | Click事件，点击 |           进入搜索id添加好友界面           |
| 搜索群聊 | Click事件，点击 |         进入搜索群聊id添加群聊界面         |
| 搜索结果 | Click事件，点击 |              进入搜索对象主页              |
| 建立群聊 | Click事件，点击 |          进入选择好友建立群聊界面          |
|   动态   | Click事件，点击 |        出现附近的人的动态和好友动态        |
| 个人信息 | Click事件，点击 |            点击修改各项个人信息            |
| 退出登陆 | Click事件，点击 |                点击退出登陆                |
|   聊天   | Click事件，点击 |                进入聊天页面                |

#### 3.2外部接口

无

#### 3.3 内部接口

客户端和本地数据库连接的接口

客户端和服务器使用websocket和http通信接口

### 4.运行设计

#### 4.1 运行模块组合

管理员账户：添加删除管理员用户、基本数据设定、注册、修改密码、管理非法
动态模块等涉及到了数据库的查询和修改
用户账户：修改密码、搜索兴趣节点、修改个人设置等模块涉及到数据库的调用
和修改
具体软件的运行组合为程序多窗口的运行过程中能较好的交换信息，处理数据

#### 4.2 运行控制

1.用户注册时需要进行邮箱验证

2.用户登陆时需要进行身份验证，用户名密码和服务器端数据库一致

3.管理员登陆后可以对系统进行设置和修改

#### 4.3运行时间

点击操作反应时间不超过1s

网络请求操作等待时间视用户网络情况而定，最长不超过10s（超过则提示错误）

### 5.系统数据结构设计

#### 5.1本地数据结构设计

##### 5.1.1 用户信息表



| 中文名 | 字段名  | 数据类型 | 描述         |
| ------ | ------- | -------- | ------------ |
| 昵称   | name    | String   | 用户昵称     |
| Id     | userId  | Striing  | 用户ID       |
| 头像   | imageId | int      | 头像图片的ID |
| 邮箱   | email   | String   | 用户邮箱地址 |



##### 5.1.2群组信息表

| 中文名 | 字段名           | 数据类型 | 描述         |
| ------ | ---------------- | -------- | ------------ |
| 群名称 | groupname        | String   | 群组名称     |
| 群人数 | number           | int      | 群的总人数   |
| 群号   | groupId          | String   | 群号         |
| 群头像 | groupHeadImageId | int      | 群组头像的ID |



##### 5.1.3消息表

| 中文名   | 字段名      | 数据类型 | 描述                                           |
| -------- | ----------- | -------- | ---------------------------------------------- |
| 消息类型 | messageType | enums    | 确定一条消息的消息类型，如群组消息或者私聊消息 |
| 发送者ID | sendUserId  | String   | 发送该消息的用户Id                             |
| 接收者ID | receiverId  | String   | 接收该消息的用户Id                             |
| 发送时间 | date        | Date     | 发送该条消息的时间                             |
| 群组Id   | groupId     | String   | 如果该消息是群组消息，这个字段的值为群号       |
| 消息内容 | message     | String   | 消息内容                                       |



#### 5.2服务器数据结构设计

服务器结构设计详情见服务器数据库设计文件

#### 5.3数据结构与程序的关系

本地数据库使用Litepal，LitePal是一款开源的Android数据库框架，采用对象关系映射（ORM）模式，将常用的数据库功能进行封装，可以不用写一行SQL语句就可以完成创建表、增删改查的操作。并且很轻量级，jar包不到100k，几乎零配置。本地建立对应的Model类将数据显示到控件上，采用对象关系映射模式，将类中的数据直接贮存到相应的表中

### 6.系统出错处理设计

#### 6.1出错信息

| 错误类型     | 错误提示                 |
| ------------ | ------------------------ |
| 输入信息错误 | 信息输入错误，请重新输入 |
| 程序运行错误 | 程序出错，退出程序       |

#### 6.2补救措施

程序出错需要重新安装，由于不面向海量用户，数据库设计简单，只在服务器端备份，本地数据库出错则重新从服务器端同步

#### 6.3系统维护设计

暂无维护模块